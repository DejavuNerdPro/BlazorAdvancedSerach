@page "/"
@inject IJSRuntime JSRuntime
@inject IUserService userSerivce
@inject IAddressService addressService
@using Models

<body class="hold-transition sidebar-mini layout-fixed">
    <div class="wrapper">
        <div class="content-wrapper">
            <!--Header-->
            <div class="content-header">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <h3 class="card-title font-weight-bold" style="margin: 5px 5px;"> Searching Component</h3>
                        </div>
                    </div>
                </div>
            </div>
            <!--Header End-->
            <!--Main Content-->
            <section class="content">
                <div class="container-fluid">
                    <div class="justify-content-center">
                        <div class="card container-fluid">
                            <div class="card-body">
                                <form method="get">
                                    <div class="row">
                                        <div class="form-group col-md-6">
                                            <label class="control-label font-weight-bold">User Name : </label>
                                            <div><input type="text" class="form-control" id="username" @bind="Name" @oninput="filterByName" /></div>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label class="control-label font-weight-bold">Age : </label>
                                            <div>
                                                <select type="text" class="form-control" id="age">
                                                    <option disabled>---All---</option>
                                                    @foreach (var age in Age)
                                                    {
                                                        <option value="@age">@age</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label class="control-label font-weight-bold">Township : </label>
                                            <div>
                                                <select type="text" class="form-control" id="township">
                                                    <option disabled>---All---</option>
                                                    @foreach (var address in Address)
                                                    {
                                                        <option value="@address">@address</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label class="control-label font-weight-bold">Phone : </label>
                                            <div>
                                                <select type="text" class="form-control" id="phone">
                                                    <option disabled>---All---</option>
                                                    @foreach (var phone in Phone)
                                                    {
                                                        <option value="@phone">@phone</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-9"></div>
                                        <div class="form-group col-md-3">
                                            <div><button type="button" class="form-control btn btn-outline-primary" id="btnSearch" value="Search"/></div>
                                        </div>
                                    </div>
                                </form>
                                <hr />
                                <table id="datatable" class="table table-responsive w-100 d-block d-md-table">
                                    <thead>
                                        <tr>
                                            <th>Id</th>
                                            <th>Name</th>
                                            <th>Age</th>
                                            <th>Gender</th>
                                            <th>Address</th>
                                            <th>Phone</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            @foreach (var user in UserList)
                                            {
                                                <td>@user.id</td>
                                                <td>@user.name</td>
                                                <td>@user.age</td>
                                                <td>@user.gender</td>
                                                <td>@user.address</td>
                                                <td>@user.phone</td>
                                            }
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!--Main Content End-->
        </div>
     </div>
</body>

@code {
    private string Name { get; set; }

    private List<UserDTO> UserList { get; set; }

    private List<int> Age { get; set; }

    private List<string> Address { get; set; }

    private List<string> Phone { get; set; }

    protected override Task OnInitializedAsync()
    {
        UserList = userSerivce.getUserAllInfo();
        Age = userSerivce.getAllUser().Select(u => u.Age).ToList();
        Address = addressService.getAllAddress().Select(ads => ads.address).ToList();
        Phone = userSerivce.getAllUser().Select(u=>u.Phone).ToList();

        return base.OnInitializedAsync();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("initializeSelect2", "age");
            await JSRuntime.InvokeVoidAsync("initializeSelect2", "township");
            await JSRuntime.InvokeVoidAsync("initializeSelect2", "phone");
        }
    }

    private void filterByName()
    {
        UserList = userSerivce.getUserAllInfo().Where(u => u.name.Contains(Name)).ToList();
        StateHasChanged();           //-----Notify Blazor something is modified.
    }
}
